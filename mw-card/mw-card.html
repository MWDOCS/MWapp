<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="stylesheet" href="https://cdn.staticfile.net/picocss/2.0.0-rc2/pico.min.css" />
    <link rel="icon" href="https://mwdocs.info/favicon.ico">
    <title>MW & MWT 文档丨资料卡生成</title>
    <style>
        .avatar {
            border-radius: 25% 10%;
            width: 120px;
        }

        .level.is-mobile .level-left {
            display: flex;
        }

        .level-item {
            margin-bottom: 0;
            margin-right: 0.75rem;
        }

        .article-licensing {
            position: relative;
            z-index: 1;
            background: #f5f5f5;
            overflow: hidden;
        }

        .article-licensing:after {
            position: absolute;
            z-index: -1;
            right: -20px;
            top: 50px;
            content: url('ships.png');
            opacity: 0.1;
        }
    </style>
</head>

<body>
    <main class="container">
        <hgroup>
            <h2>现代战舰资料卡生成</h2>
            <p>*由 MW & MWT 文档 提供支持</p>
        </hgroup>
        <a href="./index.html" role="button" class="outline">返回重做</a>
        <a href="javascript:savePicture()" role="button" class="outline">生成图片并下载</a>
    </main>
    <div class="container">
        <main id="main">
            <article class="article-licensing">
                <div id="avatar"></div>
                <br />
                <div class="level-left">
                    <div class="level-item">
                        <h5>游戏昵称</h5>
                        <b id="name"></b> <b id="title"></b>
                    </div>
                    <br>
                    <div class="level-item">
                        <h5>游戏ID</h5>
                        <b id="gameid"></b>
                    </div>
                    <br />
                    <div class="level-item">
                        <h5>游戏简历</h5>
                        <b id="about"></b>
                        <br />
                        <b id="level"></b>
                    </div>
                </div>
                <footer>
                    <hgroup>
                        <h3>现代战舰资料卡生成</h3>
                        <p><b>网站地址：https://mwapp.mwdocs.info/mw-card/</b></p>
                    </hgroup>
                </footer>
            </article>
        </main>
    </div>
    <a id="download" download target="_blank" rel="noreferrer" style="display: none;"></a>
</body>
<script type="text/javascript" src="./html2canvas.min.js"></script>
<script>
    const About = [
        '<b>无</b>',
        '<b><font color="#0f59a4">轻型巡航舰</font></b>',
        '<b><font color="#931fff">护卫舰</font></b>',
        '<b><font color="#931fff">驱逐舰</font></b>',
        '<b><font color="#931fff">巡洋舰</font></b>',
        '<b><font color="#931fff">战列舰</font></b>',
        '<b><font color="#931fff">航空母舰</font></b>',
        '<b><font color="#931fff">潜艇</font></b>',
        '<b><font color="#931fff">地效飞行器</font></b>',
        '<b><font color="#931fff">突击航空母舰</font></b>',
        '<b><font color="#931fff">空天航母</font></b>'
    ]
    const Avatar = [
        '<img class="avatar" src="./Avatar/info.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_AlfaTesters_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_CloseBetaTest_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_CommunityTournament_Winner_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_DrawingCompetitionWinner_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_GameModerators_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_GodofFortuneLNY24_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_GoldHunt_Common_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_Hacker_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_MWPress_Widget.png" />'
    ]
    const Title = [
        '',
        '<b><font color="#0f59a4">舞蹈之心</font></b>',
        '<b><font color="#f9bd10">英雄</font></b>',
        '<b><font color="#f9bd10">禄星</font></b>',
        '<b><font color="#f9bd10">食心人</font></b>',
        '<b><font color="#f9bd10">糖果之王</font></b>',
        '<b><font color="#f9bd10">派对大亨</font></b>',
        '<b><font color="#f9bd10">冬季冠军</font></b>',
        '<b><font color="#931fff">传奇</font></b>',
        '<b><font color="#931fff">神枪手</font></b>',
        '<b><font color="#931fff">财神爷</font></b>',
        '<b><font color="#931fff">奖牌得主</font></b>',
        '<b><font color="#931fff">冰霜狂欢</font></b>',
        '<b><font color="#931fff">滑雪能手</font></b>',
        '<b><font color="#931fff">年兽防御者</font></b>',
        '<b><font color="#931fff">圣诞老人助手</font></b>'
    ]
    class Profile {
        constructor(avatar, freeavatar, freeavatarQQ, name, title, gameid, about, level) {
            this.avatar = Avatar[avatar]
            this.freeavatar = freeavatar
            this.freeavatarQQ = freeavatarQQ
            this.name = name
            this.title = Title[title]
            this.gameid = gameid
            this.about = About[about]
            this.level = level
        }
    }
    function showResult(profile) {
        console.log(profile)
        if (profile.avatar == 0) {
            if (profile.freeavatar == '') {
                //document.querySelector("#avatar").innerHTML = '<img class="avatar" src="https://q.qlogo.cn/headimg_dl?dst_uin=' + profile.freeavatarQQ + '&spec=640&img_type=jpg" />'
            } else {
                //document.querySelector("#avatar").innerHTML = '<img id="base64" class="avatar" src="' + profile.freeavatar + '" />'
            }
        } else {
            document.querySelector("#avatar").innerHTML = profile.avatar
        }
        document.querySelector("#name").innerText = profile.name
        document.querySelector("#title").innerHTML = profile.title
        document.querySelector("#gameid").innerText = profile.gameid
        document.querySelector("#about").innerHTML = '<font color="#686868">擅长舰种：</font>' + profile.about
        document.querySelector("#level").innerHTML = '<font color="#686868">游戏等级：</font>' + profile.level
    }
    function tryGetParam(params, prop) {
        if (params.has(prop)) {
            return params.get(prop)
        }
        return ""
    }
    async function savePicture() {
        await html2canvas(document.querySelector("#main"), { scale: 2 }).then(
            async function (canvas) {
                canvas = canvas.toDataURL("image/png", 1);
                console.log(canvas);
                document.getElementById("download").setAttribute("href", canvas);
                document.getElementById("download").click();
            }
        );
    }
    const urlParams = new URL(window.location.href).searchParams
    let prof = new Profile(
        tryGetParam(urlParams, 'avatar'),
        tryGetParam(urlParams, 'freeavatar'),
        tryGetParam(urlParams, 'freeavatarQQ'),
        tryGetParam(urlParams, 'name'),
        tryGetParam(urlParams, 'title'),
        tryGetParam(urlParams, 'gameid'),
        tryGetParam(urlParams, 'about'),
        tryGetParam(urlParams, 'level')
    )
    showResult(prof)
</script>

</html>