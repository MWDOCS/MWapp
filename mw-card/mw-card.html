<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="stylesheet" href="./jscss/pico.min.css" />
    <link rel="icon" href="https://mwdocs.info/favicon.ico">
    <title>MW & MWT 文档丨资料卡生成</title>
    <style>
        .avatar {
            border-radius: 25% 10%;
            width: 120px;
        }

        .level.is-mobile .level-left {
            display: flex;
        }

        .level-item {
            margin-bottom: 0;
            margin-right: 0.75rem;
        }

        .article-licensing {
            position: relative;
            z-index: 1;
            background: #f5f5f5;
            overflow: hidden;
        }

        .article-licensing:after {
            position: absolute;
            z-index: -1;
            right: -20px;
            top: 50px;
            content: url('./img/ships.png');
            opacity: 0.1;
        }

        .qr {
            float: left;
        }

        .button {
            float: right;
        }
    </style>
</head>

<body>
    <main class="container">
        <hgroup>
            <h2>现代战舰资料卡生成</h2>
            <p>*由 MW & MWT 文档 提供支持</p>
        </hgroup>
        <a href="./index.html" role="button" class="outline">返回重做</a>
        <section class="button" id="modal">
            <a role="button" class="outline" data-target="modal-example" onclick="toggleModal(event)">
                生成图片并下载
            </a>
        </section>
        <dialog id="modal-example">
            <article>
                <header>
                    <h3>请注意这条消息！</h3>
                </header>
                <b>
                    为了确保图片下载可以正常的运行，请使用新的浏览器再点击下载<br />（例如 Edge、Firefox、Google Chrome）
                </b>
                <footer>
                    <a href="#cancel" role="button" class="outline" data-target="modal-example"
                        onclick="toggleModal(event)">取消</a>
                    <a href="#confirm" role="button" data-target="modal-example" class="outline"
                        onclick="javascript:savePicture()">生成图片并下载</a>
                </footer>
            </article>
        </dialog>
    </main>
    <div class="container">
        <main id="main">
            <article class="article-licensing">
                <div id="avatar"></div>
                <br />
                <div class="level-left">
                    <div class="level-item">
                        <h5>游戏昵称</h5>
                        <b id="name"></b> <b id="title"></b>
                    </div>
                    <br>
                    <div class="level-item">
                        <h5>游戏ID</h5>
                        <b id="gameid"></b>
                    </div>
                    <br />
                    <div class="level-item">
                        <h5>游戏简历</h5>
                        <b id="about"></b>
                        <br />
                        <b id="level"></b>
                        <br />
                        <b id="club"></b>
                    </div>
                </div>
                <footer id="site">
                </footer>
            </article>
        </main>
    </div>
    <a id="download" download target="_blank" rel="noreferrer" style="display: none;"></a>
</body>
<script type="text/javascript" src="./jscss/html2canvas.min.js"></script>
<script>
    const isOpenClass = "modal-is-open";
    const openingClass = "modal-is-opening";
    const closingClass = "modal-is-closing";
    const scrollbarWidthCssVar = "--pico-scrollbar-width";
    const animationDuration = 400;
    let visibleModal = null;
    const toggleModal = (event) => {
        event.preventDefault();
        const modal = document.getElementById(event.currentTarget.dataset.target);
        if (!modal) return;
        modal && (isModalOpen(modal) ? closeModal(modal) : openModal(modal));
    };
    const isModalOpen = (modal) => modal.hasAttribute("open") && modal.getAttribute("open") !== "false";
    const openModal = (modal) => {
        const { documentElement: html } = document;
        const scrollbarWidth = getScrollbarWidth();
        if (scrollbarWidth) {
            html.style.setProperty(scrollbarWidthCssVar, `${scrollbarWidth}px`);
        }
        html.classList.add(isOpenClass, openingClass);
        setTimeout(() => {
            visibleModal = modal;
            html.classList.remove(openingClass);
        }, animationDuration);
        modal.setAttribute("open", true);
    };
    const closeModal = (modal) => {
        visibleModal = null;
        const { documentElement: html } = document;
        html.classList.add(closingClass);
        setTimeout(() => {
            html.classList.remove(closingClass, isOpenClass);
            html.style.removeProperty(scrollbarWidthCssVar);
            modal.removeAttribute("open");
        }, animationDuration);
    };
    const getScrollbarWidth = () => {
        const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
        return scrollbarWidth;
    };
    const isScrollbarVisible = () => {
        return document.body.scrollHeight > screen.height;
    };
    const Site = [
        '<hgroup><div class= "qr"><img width="110" height="100%" src="./img/qr.png"></div><h3>现代战舰资料卡生成</h3><p><b>扫描二维码体验<br />网站地址：https://mwapp.mwdocs.info/mw-card/</br></p></hgroup > ',
        ''
    ]
    const Clubcolor = [
        '#000000',
        '#9ede7c',
        '#c9c93b',
        '#75b7d8',
        '#b38ae7',
        '#d69b59',
        '#eec090',
        '#ec5952'
    ]
    const About = [
        '<b>无</b>',
        '<b><font color="#0f59a4">轻型巡航舰</font></b>',
        '<b><font color="#0f59a4">护卫舰</font></b>',
        '<b><font color="#0f59a4">驱逐舰</font></b>',
        '<b><font color="#0f59a4">巡洋舰</font></b>',
        '<b><font color="#0f59a4">战列舰</font></b>',
        '<b><font color="#0f59a4">航空母舰</font></b>',
        '<b><font color="#0f59a4">潜艇</font></b>',
        '<b><font color="#0f59a4">地效飞行器</font></b>',
        '<b><font color="#0f59a4">突击航空母舰</font></b>',
        '<b><font color="#0f59a4">空天航母</font></b>'
    ]
    const Avatar = [
        '<img class="avatar" src="./Avatar/info.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_AlfaTesters_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_CloseBetaTest_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_CommunityTournament_Winner_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_DrawingCompetitionWinner_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_GameModerators_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_GodofFortuneLNY24_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_GoldHunt_Common_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_Hacker_Widget.png" />',
        '<img class="avatar" src="./Avatar/AvatarPortrait_MWPress_Widget.png" />'
    ]
    const Title = [
        '',
        '<b><font color="#0f59a4">舞蹈之心</font></b>',
        '<b><font color="#ff9900">英雄</font></b>',
        '<b><font color="#ff9900">禄星</font></b>',
        '<b><font color="#ff9900">食心人</font></b>',
        '<b><font color="#ff9900">糖果之王</font></b>',
        '<b><font color="#ff9900">派对大亨</font></b>',
        '<b><font color="#ff9900">冬季冠军</font></b>',
        '<b><font color="#931fff">传奇</font></b>',
        '<b><font color="#931fff">神枪手</font></b>',
        '<b><font color="#931fff">财神爷</font></b>',
        '<b><font color="#931fff">奖牌得主</font></b>',
        '<b><font color="#931fff">冰霜狂欢</font></b>',
        '<b><font color="#931fff">滑雪能手</font></b>',
        '<b><font color="#931fff">年兽防御者</font></b>',
        '<b><font color="#931fff">圣诞老人助手</font></b>'
    ]
    class Profile {
        constructor(avatar, freeavatar, freeavatarQQ, name, title, gameid, about, level, club, clubcolor, site) {
            this.avatar = Avatar[avatar]
            this.freeavatar = freeavatar
            this.freeavatarQQ = freeavatarQQ
            this.name = name
            this.title = Title[title]
            this.gameid = gameid
            this.about = About[about]
            this.level = level
            this.club = club
            this.clubcolor = Clubcolor[clubcolor]
            this.site = Site[site]
        }
    }
    function showResult(profile) {
        console.log(profile)
        if (profile.avatar == 0) {
            if (profile.freeavatar == '') {
                //document.querySelector("#avatar").innerHTML = '<img class="avatar" src="https://q.qlogo.cn/headimg_dl?dst_uin=' + profile.freeavatarQQ + '&spec=640&img_type=jpg" />'
            } else {
                //document.querySelector("#avatar").innerHTML = '<img id="base64" class="avatar" src="' + profile.freeavatar + '" />'
            }
        } else {
            document.querySelector("#avatar").innerHTML = profile.avatar
        }
        document.querySelector("#name").innerText = profile.name
        document.querySelector("#title").innerHTML = profile.title
        document.querySelector("#gameid").innerText = profile.gameid
        document.querySelector("#about").innerHTML = '<font color="#686868">擅长舰种：</font>' + profile.about
        if (profile.level <= 30) {
            document.querySelector("#level").innerHTML = '<font color="#686868">游戏等级：</font><font color="#63bbd0">' + profile.level + '</font>'
        } else {
            document.querySelector("#level").innerHTML = '<font color="#686868">游戏等级：</font><font color="#ff9900">' + profile.level + '</font>'
        }
        if (profile.club != '') {
            document.querySelector("#club").innerHTML = '<font color="#686868">所在舰队：</font><font color="' + profile.clubcolor + '">' + profile.club + '</font>'
        }
        document.querySelector("#site").innerHTML = profile.site
    }
    function tryGetParam(params, prop) {
        if (params.has(prop)) {
            return params.get(prop)
        }
        return ""
    }
    async function savePicture() {
        await html2canvas(document.querySelector("#main"), { scale: 2 }).then(
            async function (canvas) {
                canvas = canvas.toDataURL("image/png", 1);
                console.log(canvas);
                document.getElementById("download").setAttribute("href", canvas);
                document.getElementById("download").click();
            }
        );
    }
    const urlParams = new URL(window.location.href).searchParams
    let prof = new Profile(
        tryGetParam(urlParams, 'avatar'),
        tryGetParam(urlParams, 'freeavatar'),
        tryGetParam(urlParams, 'freeavatarQQ'),
        tryGetParam(urlParams, 'name'),
        tryGetParam(urlParams, 'title'),
        tryGetParam(urlParams, 'gameid'),
        tryGetParam(urlParams, 'about'),
        tryGetParam(urlParams, 'level'),
        tryGetParam(urlParams, 'club'),
        tryGetParam(urlParams, 'clubcolor'),
        tryGetParam(urlParams, 'site')
    )
    showResult(prof)
</script>

</html>